<%- include ('../partials/header.ejs', {username: username, role: role}) %>
<% const totalUsers = users.length %>
<div class="container-fluid">
    <div class="jumbotron">
        <!-- Error Message -->
        <%- include ('../partials/error_message.ejs') %>
        <div class="card">
            <div class="card-header">
                <h3 class="m-0">Users</h3> 
            </div>
            <div class="card-body">
                <h5 class="card-search">
                    <a class="btn btn-outline-success" href="/admin/users/add_user"> + Add User</a>
                </h5>
                <table class="table table-hover table-bordered" id="users">
                    <thead class="thead-dark">
                        <tr>
                            <th scope="col">ID</th>
                            <th scope="col">Name</th>
                            <th scope="col">Email</th>
                            <th scope="col">Registration Date/Time</th>
                            <th scope="col">Role</th>
                            <th scope="col">Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% let i=0 %>
                        <% users.forEach( user => { %>
                        <% i++ %>
                        <tr>
                            <th><%- user.ID %></th>
                            <td><%= user.Name %></td>
                            <td><%= user.Email %></td>
                            <td><%= user.Registered.toUTCString() %></td>
                            <td><%= user.Role %></td>
                            <td>
                                <% if (user.ID == id) { %>
                                <button type="button" class="openStatusForm btn btn-success" data-stat="1"
                                    data-id=<%=i%> data-toggle="modal" data-target="#status" data-backdrop="static"
                                    data-keyboard="false" disabled value="1">&nbsp;&nbsp;ACTIVE&nbsp;</button>
                                <% } else if (user.Status) { %>
                                <button type="button" class="openStatusForm btn btn-success" data-stat="1"
                                    data-id=<%=i%> data-toggle="modal" data-target="#status" data-backdrop="static"
                                    data-keyboard="false" value="1" onclick="onStatusUpdate()">&nbsp;&nbsp;ACTIVE&nbsp;</button>
                                <% } else { %>
                                <button type="button" class="openStatusForm btn btn-warning" data-stat="0"
                                    data-id=<%=i%> data-toggle="modal" data-target="#status" data-backdrop="static"
                                    data-keyboard="false" value="0" onclick="onStatusUpdate()">INACTIVE</button>
                                <% } %>
                            </td>
                        </tr>
                        <% }) %>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="status" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">User Status</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form action="/admin/users/update_status" id="statusForm" method="POST">
                    <div class="form-group mb-3">
                        <select class="mdb-select md-form form-control my-1 mr-sm-2" name="statusSelection"
                            id="statusSelection">
                            <option value="" disabled selected>Select status</option>
                            <option id="activeOption" value="1">ACTIVE</option>
                            <option id="inactiveOption" value="0">INACTIVE</option>
                        </select>
                        <input type="hidden" name="userId" id="userId" value="" hidden />
                    </div>
                    <small></small>
                    <div class="float-right">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                        <button type="submit" onclick="return statusValidation()" class="btn btn-primary">Save</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
<%- include ('../partials/footer.ejs') %>
<script src="/js/update_status.js"></script>